# webserv
teeeee
# 1. í”„ë¡œì íŠ¸ ì†Œê°œ ğŸ˜®
### ì†Œê°œ :
* nginx ì„œë²„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

### ê¸°ê°„ :
* 2022.03.08 ~ 

### ìš”ì•½ :
1. ì´ ê³¼ì œëŠ” HTTP ì„œë²„ì¸ [nginx](https://whatisthenext.tistory.com/123)ë¥¼ ë§Œë“­ë‹ˆë‹¤.
2. ì‹¤ì œ **HTTP RFC(7230~7235)**ì™€ ë‹¤ë¦…ë‹ˆë‹¤. 
3. ì‹¤ì œ ë¸Œë¼ìš°ì €ë¡œ í…ŒìŠ¤íŠ¸ í–ˆìŠµë‹ˆë‹¤.
4. í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ í†µì‹ ì€ [Hypertext Transfer í”„ë¡œí† ì½œ](https://docs.oracle.com/cd/E19857-01/817-7510/agaphttp.html)ì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
5. íŠ¸ë˜í”½ì´ ë§ì€ ì›¹ ì‚¬ì´íŠ¸ì— ì—¬ëŸ¬ ì›¹ ì„œë²„ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–‡ìŠµë‹ˆë‹¤.
6. ì¼ë°˜ì ìœ¼ë¡œ ì›¹ ë¸Œë¼ìš°ì € ë˜ëŠ” ì›¹ í¬ë¡¤ëŸ¬(í´ë¼ì´ì–¸íŠ¸)ì™€ ê°™ì€ ì‚¬ìš©ì ì—ì´ì „íŠ¸ëŠ” ë‹¤ìŒì„ í†µí•´ í†µì‹ ì„ ì‹œì‘í•©ë‹ˆë‹¤.
	* HTTPë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ë©´ ì„œë²„ê°€ í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì˜ ë‚´ìš©ìœ¼ë¡œ ì‘ë‹µí•˜ê±°ë‚˜, ê·¸ë ‡ê²Œ í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.
	* ë¦¬ì†ŒìŠ¤ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì˜ ë³´ì¡° ìŠ¤í† ë¦¬ì§€ì— ìˆëŠ” ì‹¤ì œ íŒŒì¼ì´ì§€ë§Œ, ë°˜ë“œì‹œ ê·¸ëŸ° ê²ƒì€ ì•„ë‹ˆë©° ì›¹ ì„œë²„ê°€ êµ¬í˜„ë˜ëŠ” ë°©ë²•ì— ë”°ë¼ ë‹¤ë¥´ê²Œ êµ¬í˜„í•´ë„ ë©ë‹ˆë‹¤.
7. ì£¼ìš” ê¸°ëŠ¥ì€ ì½˜í…ì¸ ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ì§€ë§Œ, HTTPì˜ ì „ì²´ êµ¬í˜„ì€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì½˜í…ì¸ ë¥¼ ë°›ëŠ” ë°©ë²•ë„ í¬í•¨ë©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ íŒŒì¼ ì—…ë¡œë”©ì„ í¬í•¨í•œ ì›¹í¼ ì œì¶œì— ì‚¬ìš©ë©ë‹ˆë‹¤. 

# 2. ì„¸ë¶€ ëª…ì„¸ì„œ(Mandatory part) ğŸ¹
### í—ˆìš©í•¨ìˆ˜

* [ì™¸ë¶€í•¨ìˆ˜ ë¸”ë¡œê·¸ ì •ë¦¬í•œê±°!](https://velog.io/@hey-chocopie/webserve-%EC%99%B8%EB%B6%80%ED%97%88%EC%9A%A9%ED%95%A8%EC%88%98)

```
Everything in C++ 98. htons, htonl, ntohs, ntohl,
select, poll, epoll (epoll_create, epoll_ctl,
epoll_wait), kqueue (kqueue, kevent), socket,
accept, listen, send, recv, bind, connect,
inet_addr, setsockopt, getsockname, fcntl.
```

1. **FD_SET, FD_CLR, FD_ISSET, FD_ZERO** ê°™ì€ ëª¨ë“  ë©”í¬ë¡œì™€ ì •ì˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì–´ë–»ê²Œ ì“¸ì§€ ì´í•´í•˜ëŠ”ê±´ ë§¤ìš° ì¤‘ìš”)
2. HTTP ì„œë²„ëŠ” C++ 98ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
3. ë” ë§ì€ C í•¨ìˆ˜ê°€ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ í•­ìƒ C++ë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤.
4. ì»´íŒŒì¼ì€ C++ 98ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
5. ì™¸ë¶€ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ, ë¶€ìŠ¤íŠ¸ ì—†ìŒ, ë“±.
6. ê°€ëŠ¥í•œ c++ì„ ì¨ë¼(ì˜ˆë¥¼ ë“¤ì–´ í—¤ë”íŒŒì¼ì— cstringë¡œ í‘œê¸°í•´ë¼. string.hê°€ ì•„ë‹ˆë¼)
7. ì„œë²„ëŠ” ì„ íƒí•œ ì›¹ ë¸Œë¼ìš°ì €ì™€ í˜¸í™˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
8. nginxëŠ” **HTTP 1.1**ì„ ì¤€ìˆ˜í•˜ë©° í—¤ë” ë° ì‘ë‹µ ë™ì‘ì„ ë¹„êµí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
9. ì£¼ì œì™€ ê·œëª¨ì—ì„œ ì—¬ë¡ ì„ í†µí•´ ì–¸ê¸‰ í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **select, kqueue, epoll** ëŠ” ë™ë“±í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.
10. **ë…¼ë¸”ë¡œí‚¹**ì´ì–´ì•¼í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ì‚¬ì´ì˜ ëª¨ë“  IOì— ëŒ€í•´ select 1ê°œë§Œ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤(listen í¬í•¨).
11. **poll(select)**(ë˜ëŠ” ì´ì™€ ë™ë“±í•œ ê²ƒ)ì€ ì½ê¸°ì™€ ì“°ê¸°ë¥¼ ë™ì‹œì— í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
12. ì„œë²„ë¥¼ ì ˆëŒ€ **ë¸”ë¡œí‚¹**ì´ ë˜ë©´ ì•ˆë˜ê³ , í•„ìš”í•œ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ê°€ ì œëŒ€ë¡œ **ë°”ìš´ìŠ¤**ë˜ì–´ì•¼ í•©ë‹ˆë‹¤
13. poll(ë˜ëŠ” ì´ì™€ ë™ë“±í•œ ê²ƒ)ì„ ê±°ì¹˜ì§€ ì•Šê³  ì½ê¸° ì‘ì—…ì´ë‚˜ ì“°ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
14. ì½ê¸° ë˜ëŠ” ì“°ê¸° ì‘ì—… í›„ errno ê°’ í™•ì¸ì€ ì—„ê²©íˆ ê¸ˆì§€ë©ë‹ˆë‹¤.
15. ì„œë²„ì— ëŒ€í•œ ìš”ì²­ì´ ì˜ì›íˆ ì¤‘ë‹¨ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
16. noneì´ ì œê³µë˜ë©´, ë‹¹ì‹ ì˜ ì„œë²„ì—ëŠ” ê¸°ë³¸ ì˜¤ë¥˜ í˜ì´ì§€ê°€ ìˆì–´ì•¼í•©ë‹ˆë‹¤.
17. í”„ë¡œê·¸ë¨ì´ ëˆ„ì¶œë˜ì–´ì„œëŠ” ì•ˆ ë˜ë©° ì¶©ëŒë„ ë°œìƒí•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤(ëª¨ë“  ì´ˆê¸°í™”ê°€ ì™„ë£Œëœ ê²½ìš° ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ë”ë¼ë„).
18. **í¬í¬**ë¥¼ **CGI** ì´ì™¸ì˜ ë‹¤ë¥¸ ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤(ì˜ˆ: php ë˜ëŠ” python ë“±...).
19. ë‹¹ì‹ ì€ ë‹¤ë¥¸ ì›¹ ì„œë²„ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ... (You canâ€™t execve another webserver...ë¬´ìŠ¨ë§..) 
20. ë‹¹ì‹ ì˜ í”„ë¡œê·¸ë¨ì€ argumentê²½ë¡œë‚˜, defaultê²½ë¡œì— config fileì„ ê°€ì§„ë‹¤.
21. config fileì„ ì½ê¸° ì „ì— poll(ë˜ëŠ” ì´ì™€ ë™ë“±í•œ ê²ƒ)ì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
22. ì™„ì „íˆ **ì •ì ì¸ ì›¹ì‚¬ì´íŠ¸**ë¥¼ ì œê³µí•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. (You should be able to serve a fully static website.)
23. í´ë¼ì´ì–¸íŠ¸ê°€ íŒŒì¼ì„ ì—…ë¡œë“œ í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤
24. HTTP ì‘ë‹µ [status codes](https://ko.wikipedia.org/wiki/HTTP_%EC%83%81%ED%83%9C_%EC%BD%94%EB%93%9C) ëŠ” ì •í™•í•´ì•¼ í•©ë‹ˆë‹¤.
25. ìµœì†Œí•œ **GET, POST ë° DELETE** ë©”ì†Œë“œ í•„ìš”í•©ë‹ˆë‹¤.
26. stress testëŠ” ì„œë²„ê°€ ì–´ë–¤ ë¹„ìš©ì„ ì¹˜ë¥´ë”ë¼ë„ ê³„ì† ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤
27. ë‹¹ì‹ ì˜ ì„œë²„ëŠ” ì—¬ëŸ¬ í¬íŠ¸ì—ì„œ ìˆ˜ì‹ ëŒ€ê¸° í•  ìˆ˜ ìˆë‹¤.(See config file).

>ì •ë³´) mac os XëŠ” writeë¥¼ ë‹¤ë¥¸ Unix OSì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ  êµ¬í˜„í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— fcntlì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ OSì™€ ë¹„ìŠ·í•œ ê²°ê³¼ë¥¼ ì–»ìœ¼ë ¤ë©´ non-blocking FDë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

>ì£¼ì˜) ë‹¹ì‹ ì´ non-blocking FDë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— read/recv ë˜ëŠ” write/send í•¨ìˆ˜ë¥¼ select ì—†ì´ ì‚¬ìš©í•˜ë©´ ì„œë²„ê°€ ë¸”ë¡œí‚¹ë˜ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤. ë‹¤ì‹œ í•œ ë²ˆ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤. selectë¥¼ í†µí•˜ì§€ ì•Šê³  ì–´ëŠ FDì—ì„œë“  read/recv ë˜ëŠ” write/sendë¥¼ ì‹œë„í•˜ëŠ” ê²ƒì€ í‰ê°€ì—ì„œ 0ì  ì²˜ë¦¬ ë©ë‹ˆë‹¤.

>ì£¼ì˜) ë‹¹ì‹ ì€ ë‹¤ìŒê³¼ ê°™ì´ fcntlì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. : fcntl(fd, F_SETFL, O_NONBLOCK);
	ë‹¤ë¥¸ ëª¨ë“  flagëŠ” ê¸ˆì§€í•©ë‹ˆë‹¤.

# 3. config fileì—ì„œ ë‹¤ìŒì„ ìˆ˜í–‰ í•  ìˆ˜ ìˆì–´ì•¼í•©ë‹ˆë‹¤. ğŸ˜¾
>ë‹¹ì‹ ì€ ft_servicesë‚˜ ì§„í–‰í–ˆë˜ ì„œë²„ íŒŒíŠ¸ì—ì„œ configuration fileì— ëŒ€í•œ ì˜ê°ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

* ê° ì„œë²„ì˜ í¬íŠ¸ë‚˜ í˜¸ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.

# 4. nginx ê¸°ë³¸êµ¬ì¡°.
```
.
â”œâ”€â”€ fastcgi.conf
â”œâ”€â”€ fastcgi.conf.default
â”œâ”€â”€ fastcgi_params
â”œâ”€â”€ fastcgi_params.default
â”œâ”€â”€ koi-utf
â”œâ”€â”€ koi-win
â”œâ”€â”€ mime.types
â”œâ”€â”€ mime.types.default
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ nginx.conf.default
â”œâ”€â”€ scgi_params
â”œâ”€â”€ scgi_params.default
â”œâ”€â”€ servers
â”œâ”€â”€ uwsgi_params
â”œâ”€â”€ uwsgi_params.default
â””â”€â”€ win-utf

1 directory, 15 files
```

# 4. í”„ë¡œì íŠ¸ ê¸°ë°˜ ì§€ì‹ âœï¸

